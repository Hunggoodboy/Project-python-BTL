<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>{{ product.name }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/productdetail.css') }}">
</head>
<body>
    <div class="product-detail">
    <div class="image-viewer">
      <button class="nav-btn left" onclick="prevImage()">‚ùÆ</button>
      <img id="main-image" src="{{url_for('static', filename = product.HinhAnh)}}" alt="{{ product.TenSP }}">
      <button class="nav-btn right" onclick="nextImage()">‚ùØ</button>
    </div>
    <div class="price-row">
      <span class="price">{{ "{:,.0f}".format(product.Gia) }}‚Ç´</span>
      <span class="sold">ƒê√£ b√°n: {{ product.Sold }}</span>
    </div>
    <div class="discount">
      Gi·∫£m: {{ product.Discount }}%
    </div>
    <h2 class="product-name">{{ product.TenSP }}</h2>
    <div class="section section-box color">
        <strong>M√†u s·∫Øc:</strong>
        <div class="color-options">
            {% for color in product.colors %}
            <img src="{{ color.image }}" class="color-thumb" onclick="changeColor('{{ color.image }}')" alt="{{ color.name }}">
            {% endfor %}
        </div>
    </div>
    <div class = "size-chart">
        <div class="section section-box size">
            <strong>Size:</strong>
            <div class="size-options">
                {% for s in product.sizes %}
                <button class="size-btn">{{ s }}</button>
                {% endfor %}
            </div>
        </div>
        <a href="{{ url_for('productdetail.sizechart') }}">B·∫£ng size</a>
    </div>
    <div class="section section-box shipping" onclick="openModal('shipping-modal')">
        üì¶ Th·ªùi gian nh·∫≠n h√†ng
    </div>

    <div class="section section-box description" onclick="openModal('desc-modal')">
        üßæ Th√¥ng s·ªë & m√¥ t·∫£
    </div>
    <div class="rating section-box">
        ‚≠ê {{ product.rating }} / 5 ({{ product.review_count }} l∆∞·ª£t ƒë√°nh gi√°)
    </div>
    <div class="comments section-box">
        <h3>üí¨ B√¨nh lu·∫≠n c·ªßa kh√°ch h√†ng</h3>
        {% for c in product.comments %}
            <div class="comment">
            <strong>{{ c.user }}</strong>: {{ c.text }}
            </div>
        {% endfor %}
        </div>
    </div>
    <div id="shipping-modal" class="modal">
        <div class="modal-content">
        <span class="close" onclick="closeModal('shipping-modal')">&times;</span>
        <h3>Th·ªùi gian nh·∫≠n h√†ng</h3>
        <p>{{ product.shipping_info }}</p>
        </div>
    </div>
    <div id="desc-modal" class="modal">
        <div class="modal-content">
        <span class="close" onclick="closeModal('desc-modal')">&times;</span>
        <h3>Th√¥ng s·ªë s·∫£n ph·∫©m</h3>
        <p>{{ product.description }}</p>
        </div>
    </div>

    <div class="action-row">
        <button class="add-cart" onclick="openProductModal('add')">Th√™m v√†o gi·ªè h√†ng</button>
        <button class="buy-now" onclick="openProductModal('buy')">ƒê·∫∑t h√†ng</button>
    </div>

    <div class="product-modal" id="product-modal">
        <div class="modal-content">
            <span class="close" onclick="closeProductModal()">&times;</span>
            <div class="modal-top">
                <img id="modal-main-img" src="{{url_for('static', filename = product.HinhAnh)}}" alt="{{ product.name }}">
                <div class="price-stock">
                    <p>Gi√°: {{ "{:,.0f}".format(product.Gia) }}‚Ç´</p>
                    <p>S·ªë c√≤n trong kho: <span id="stock-count">{{ product.SoLuongcon }}</span></p>
                </div>
            </div>

            <div class="modal-section">
                <p>Ph√¢n lo·∫°i:</p>
                <div class="options">
                    {% for color in product.colors %}
                    <button onclick="changeModalImage('{{ color.image }}')">
                        <img src="{{ color.image }}" alt="{{ color.name }}">
                        <span>{{ color.name }}</span>
                    </button>
                    {% endfor %}
                </div>
            </div>

            <div class="quantity-control">
                <span>S·ªë l∆∞·ª£ng:</span>
                <div>
                    <button class="qty-btn" id="decrease" onclick="changeQuantity(-1)">-</button>
                    <input type="text" id="quantity" value="1" readonly>
                    <button class="qty-btn" id="increase" onclick="changeQuantity(1)">+</button>
                </div>
            </div>

            <div class="modal-footer">
                <button class="add-cart" id="modal-add-cart">Th√™m v√†o gi·ªè h√†ng</button>

                <button class="buy-now" id="modal-buy-now">ƒê·∫∑t h√†ng</button>

            </div>
        </div>
    </div>
    <script id="image-data" type="application/json">
        {{ product.images | default([])| tojson }}
    </script>
    <script>
        const PRODUCT_ID = {{ product.MaSP | default(0) | tojson }};
        const maxStock = {{ product.SoLuongcon  | default(10) | tojson }};
    </script>

<script src="{{ url_for('static', filename='js/product_detail.js') }}"></script>
<script src="{{ url_for('static', filename='js/order_product.js') }}"></script>
    
<!-- script b√¨nh lu·∫≠n v√† ƒë√°nh gi√° -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const productId = "{{ product.id }}";
    const reviews = JSON.parse(localStorage.getItem('product_reviews') || '{}');
    if (reviews[productId]) {
        const data = reviews[productId];
        document.querySelector(".rating").innerHTML = `‚≠ê ${data.avg.toFixed(1)} / 5 (${data.count} l∆∞·ª£t ƒë√°nh gi√°)`;
        const commentContainer = document.querySelector(".comments");
        data.comments.forEach(c => {
        const div = document.createElement("div");
        div.className = "comment";
        const starsHTML = "‚òÖ".repeat(c.stars) + "‚òÜ".repeat(5 - c.stars);
        div.innerHTML = `
            <img src="/static/images/user.png" class="avatar">
            <div>
            <div class="comment-stars">${starsHTML}</div>
            <strong>${c.user}</strong>: ${c.text}
            </div>
        `;
        commentContainer.appendChild(div);
        });
    }
});
</script>

<style>
.comment { display: flex; align-items: flex-start; margin-top: 10px; gap: 10px; }
.comment img.avatar { width: 35px; height: 35px; border-radius: 50%; }
.comment-stars { color: gold; font-size: 16px; line-height: 1; margin-bottom: 3px; }
</style>
</body>
</html>
